<mat-toolbar name="header" id="header" class="banners">
  <span>Welcome to RideShare!</span>
</mat-toolbar>

<div id="outer-container">
  <div
    id="form-div"
    fxLayout="row"
    fxLayoutAlign="center center"
    class="login-main"
  >
    <mat-card>
      <mat-card-header>
        <mat-card-title>Please Register Below</mat-card-title>
      </mat-card-header>
      <mat-card-content class="full">
        <table>
          <tr class="full">
            <td class="half">
              <mat-form-field class="full">
                <!-- through these first fields we use the relatively routine
                ngModel function of binding input to a field, except in this case  we are binding
              to the empty user object created in the registractionComponent.ts constructor -->
                <input
                  matInput
                  placeholder="First Name"
                  name="firstName"
                  [(ngModel)]="user.firstName"
                />
              </mat-form-field>
            </td>
            <td class="half">
              <mat-form-field class="full">
                <input
                  matInput
                  placeholder="Last Name"
                  name="lastName"
                  [(ngModel)]="user.lastName"
                />
              </mat-form-field>
            </td>
          </tr>
          <tr class="full">
            <td class="half">
              <mat-form-field class="full">
                <input
                  type="email"
                  matInput
                  placeholder="Email"
                  name="email"
                  [(ngModel)]="user.email"
                />
              </mat-form-field>
            </td>
            <td class="half">
              <mat-form-field class="full">
                <input
                  type="password"
                  matInput
                  placeholder="Password"
                  name="password"
                  [(ngModel)]="password"
                />
              </mat-form-field>
            </td>
          </tr>
          <tr class="full">
            <td class="half">
              <mat-form-field class="full">
                <input
                  type="phoneNumber"
                  matInput
                  placeholder="Phone Number"
                  name="phoneNumber"
                  [(ngModel)]="user.phoneNumber"
                />
              </mat-form-field>
            </td>
            <td class="half">
              <mat-form-field class="full">
                <!-- here, we double bind, first binding the form field to the selected value,
                 then binding the user.role to that selected value-->
                <mat-select
                  placeholder="Do you have a car?"
                  [(ngModel)]="selectedValue"
                  name="role"
                  [(ngModel)]="user.role"
                >
                  <mat-option value="RIDER">I don't have a car :(</mat-option>
                  <mat-option value="DRIVER">I have a car!</mat-option>
                </mat-select>
              </mat-form-field>
            </td>
          </tr>
          <tr>
            <!--  the table structure needs these empty elements to maintain space in card -->
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="full" *ngIf="selectedValue == 'DRIVER'">
            <td class="half">
              <mat-form-field class="full">
                <mat-select
                  placeholder="How many seats in your car?"
                  [(ngModel)]="selectedSeats"
                  name="numberOfSeats"
                  [(ngModel)]="user.carDto.seatNumber"
                >
                  <mat-option value="1">1</mat-option>
                  <mat-option value="2">2</mat-option>
                  <mat-option value="3">3</mat-option>
                  <mat-option value="4">4</mat-option>
                  <mat-option value="5">5</mat-option>
                  <mat-option value="6">6</mat-option>
                </mat-select>
              </mat-form-field>
            </td>
          </tr>
          <tr class="full">
            <!-- we need a structural directive to use the async pipe,
            ngIf* is great for that, and we pipe the output to a new name for clarity.
          async removes the observable 'state'. Remember, [state].array.item -->
            <td
              class="half"
              *ngIf="allTrainingLocations | async as trainingLocations"
            >
              <!-- we bind training location to the selected item, in this case training location object.name -->
              <mat-select
                placeholder="Training Location"
                [(ngModel)]="selectedLocation"
                name="selectedTrainingLocation"
              >
                <!-- we use ngFor to loop through the array interpolating the names conatined therein -->
                <mat-option
                  *ngFor="let i of trainingLocations"
                  [(value)]="i.trainingLocationName"
                  >{{ i.trainingLocationName }}</mat-option
                >
              </mat-select>
            </td>
          </tr>
          <tr class="full">
            <!-- similar to above, remove observable pipe to new name -->
            <td
              class="half"
              *ngIf="allHouseLocations | async as housingLocations"
            >
              <!-- because the user object contains a housing object, we bind to whole object
            by setting value in mat-option to 'i' instead of i.name, but we dispaly i.name with 
          interpolation -->
              <mat-select
                placeholder="Housing Location Name"
                name="selectedHousingLocation"
                [(ngModel)]="user.houseLocation"
              >
                <!-- we only want to display housing locations that are in a selected training location,
              so we use a pipe to filter the selection. this custom pipe filters by the selected location value
            bound above. it is an impure pipe, meaning it will be reapplied any time its input parameters, either the
          array of housing locations or the value of the selectedLocation string are changed. 
          You have offically achieved Jedi angular skills  -->
                <mat-option
                  *ngFor="
                    let i of housingLocations | isLocation: selectedLocation
                  "
                  [(value)]="i"
                  >{{ i.housingLocationName }}</mat-option
                >
              </mat-select>
            </td>
          </tr>
        </table>
      </mat-card-content>
      <mat-card-actions align="end">
        <button routerLink="/" type="button" class="btn">
          BACK TO LOGIN
        </button>
        <button (click)="register($event)" type="button" class="btn">
          SUBMIT
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>

<div>
  <app-footer></app-footer>
</div>
