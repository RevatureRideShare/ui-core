#!groovy

pipeline {
    agent any
    triggers {
      cron('H H/8 * * 1-5')
    }    
    stages {
        stage('Install') {
            steps {
                sh '''
                    . ~/.nvm/nvm.sh
                    cd /home/ec2-user/.jenkins/workspace/ore_chore_1-PhantomJS-dependency/RideShare
		                npm install
                '''
            }
         }
         /*
        stage('test') {
              steps {
                sh '''
                    cd /home/ec2-user/.jenkins/workspace/ore_chore_1-PhantomJS-dependency/RideShare
		                npm install
                    npm run test-headless
                '''
            }
        }
        */
        stage('Build') {
              steps {
                sh '''
                    cd /home/ec2-user/.jenkins/workspace/ore_chore_1-PhantomJS-dependency/RideShare
		                ng build
                '''
            }
        }
        
        stage('Deploy') {
              steps {
                echo "Branch name: "
                echo env.BRANCH_NAME
                if(env.BRANCH_NAME == 'chore/1-PhantomJS-dependency'){
                  sh '''
                      cd /home/ec2-user/.jenkins/workspace/ore_chore_1-PhantomJS-dependency/RideShare
                      aws s3 cp --recursive ./dist/Project3 s3://rideshare-client
                  '''
                }
            }
        }
    }
}