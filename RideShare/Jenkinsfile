pipeline {
    agent any 
    stages {
        stage('Checkout'){
            steps{
                sh '''
                cd /home/ec2-user/.jenkins/workspace/Headless_testing/
                deleteDir()
                '''
            }
        }
        stage('Chromium Install') {
            steps{
                sh '''
                cd /home/ec2-user
                wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm
                sudo yum install ./google-chrome-stable_current_x86_64.rpm
                sudo ln -s /usr/bin/google-chrome-stable /usr/bin/chromium
                '''
            } 
        }
        stage('Npm install'){
            steps{
                sh '''
                cd /home/ec2-user/.jenkins/workspace/ui-core/RideShare
                npm i
                '''
            }
        }
        stage('Test'){
            withEnv(["CHROME_BIN=/usr/bin/chromium"]) {
              sh '''
                    cd /home/ec2-user/.jenkins/workspace/ui-core/RideShare
                    npm run test-headless
                '''
            }
        }
        // stage('Build') { 
        //   steps {
        //         sh '''
        //         cd /home/ec2-user/.jenkins/workspace/ui-core/RideShare
        //         ng build
        //         '''
        //   }
        // }
        // stage('Deploy'){
        //     steps{
        //         sh '''
        //         cd /home/ec2-user/.jenkins/workspace/ui-core/RideShare
        //          aws2 s3 cp --recursive ./dist s3://ui-core/angular
        //         '''
        //     }
        // }
    }
}