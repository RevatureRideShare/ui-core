#!groovy

pipeline {
    agent any
    triggers {
        pollSCM('H H/8 * * *')
    }    
    stages {
        stage('Install') {
            steps {
                sh '''
                    . ~/.nvm/nvm.sh
                    pwd
                    cd RideShare
		            npm install
                '''
            }
         }
         
        stage('test') {
              steps {
                sh '''
                    pwd
                    npm run test-headless
                '''
            }
        }
        
        stage('Build') {
              steps {
                
                sh '''
                    . ~/.nvm/nvm.sh
                    pwd
		            ng build
                '''
            }
        }
        
        stage('Deploy') {
              steps {
                script{
                  if(env.BRANCH_NAME == 'chore/master'){
                    sh '''
                        cd /home/ec2-user/.jenkins/workspace/master/RideShare
                        aws s3 cp --recursive ./dist/Project3 s3://rideshare-client
                    '''
                  }
                }
            }
        }
    }
}